import{a2 as g,a0 as I,$ as w,a3 as ae}from"./request-372f441e.js";import{M as oe}from"./index-492d5734.js";import{c as B}from"./common-fa9d7b0c.js";import{u as ne}from"./vue-i18n.cjs-ef3fa138.js";import{_ as se}from"./_plugin-vue_export-helper-c27b6911.js";import{r as x,e as le,v as j,i as o,o as i,c as L,a as d,p as t,k as e,j as p,s as f,l as P,F as ce,L as ie,S as R,u as y}from"./runtime-core.esm-bundler-0dd628d9.js";const v={getPageList(s={}){return g({url:"system/attachment/index",method:"get",params:s})},getRecyclePageList(s={}){return g({url:"system/attachment/recycle",method:"get",params:s})},deletes(s){return g({url:"system/attachment/delete",method:"delete",data:s})},recoverys(s){return g({url:"system/attachment/recovery",method:"put",data:s})},realDeletes(s){return g({url:"system/attachment/realDelete",method:"delete",data:s})}};const de={class:"ma-content-block lg:flex justify-between pt-4 pl-2 pr-2 pb-2"},re={class:"lg:w-2/12 w-full h-full p-2 shadow"},ue={class:"lg:w-10/12 w-full lg:ml-4 mt-5 lg:mt-0"},_e={class:"actions"},me=["onClick"],pe={class:"action"},he={name:"system:attachment"},ge=Object.assign(he,{setup(s){ne();const r=x(),u=x("list"),b=x([]),_=x([]);le(async()=>{const a=await B.getDict("attachment_type");a.data.unshift({title:"所有",key:"all"}),b.value=a.data});const N=async a=>{const l=a[0]==="all"?void 0:a[0];r.value.requestParams.mime_type=l,r.value.refresh()},T=()=>{u.value=u.value==="list"?"window":"list"},A=async a=>{let l="",h=k(a.storage_mode);h!=="LOCAL"?(w.info("处理中..."),l=upload.storage[h]+a.url):(w.info("请求服务器下载文件中..."),l="system/downloadById?id="+a.id);const m=await B.download(l,"get");m?(I.download(m,h!=="LOCAL"?a.origin_name:""),w.success("请求成功，文件开始下载")):w.error("文件下载失败")},$=a=>{_.value=a,r.value.setSelecteds(a)},q=()=>{r.value.getTableData().map(a=>_.value.push(a.id)),r.value.setSelecteds(_.value)},U=()=>{_.value=[],r.value.setSelecteds([])},k=a=>ae.storageMode[a.toString()],E=j({api:v.getPageList,recycleApi:v.getRecyclePageList,searchColNumber:3,requestParams:{},showIndex:!1,pageLayout:"fixed",rowSelection:{showCheckedAll:!0},operationColumn:!0,operationWidth:200,delete:{show:!0,api:v.deletes,auth:["system:attachment:delete"],realApi:v.realDeletes,realAuth:["system:attachment:realDeletes"]},recovery:{show:!0,api:v.recoverys,auth:["system:attachment:recovery"]},isDbClickEdit:!1}),O=j([{title:"预览",dataIndex:"url",width:80},{title:"存储名称",dataIndex:"object_name",width:220},{title:"原文件名",dataIndex:"origin_name",width:150,search:!0},{title:"存储模式",dataIndex:"storage_mode",width:100,search:!0,formType:"select",dict:{name:"upload_mode",props:{label:"title",value:"key"},translation:!0}},{title:"资源类型",dataIndex:"mime_type",width:130},{title:"存储目录",dataIndex:"storage_path",width:130},{title:"文件大小",dataIndex:"size_info",width:130},{title:"上传时间",dataIndex:"created_at",width:180,search:!0,formType:"range"}]);return(a,l)=>{const h=o("icon-select-all"),m=o("a-button"),D=o("icon-eraser"),z=o("a-input-group"),F=o("icon-apps"),W=o("icon-list"),C=o("a-tooltip"),G=o("icon-check"),H=o("a-tag"),J=o("a-checkbox"),V=o("icon-download"),K=o("icon-info-circle"),S=o("a-image"),Q=o("a-space"),X=o("a-image-preview-group"),Y=o("a-checkbox-group"),Z=o("a-avatar"),ee=o("a-link"),te=o("ma-crud");return i(),L("div",de,[d("div",re,[t(oe,{modelValue:b.value,"onUpdate:modelValue":l[0]||(l[0]=c=>b.value=c),"search-placeholder":a.$t("maResource.searchResource"),"field-names":{title:"title",key:"key"},onClick:N,icon:"icon-folder","selected-keys":["all"]},null,8,["modelValue","search-placeholder"])]),d("div",ue,[t(te,{options:E,columns:O,ref_key:"crudRef",ref:r},{tableAfterButtons:e(()=>[u.value==="window"?(i(),p(z,{key:0},{default:e(()=>[t(m,{onClick:q},{icon:e(()=>[t(h)]),default:e(()=>[f("全选")]),_:1}),t(m,{onClick:U},{icon:e(()=>[t(D)]),default:e(()=>[f("清除")]),_:1})]),_:1})):P("",!0)]),tools:e(()=>[t(C,{content:u.value==="list"?"切换橱窗模式":"切换列表模式"},{default:e(()=>[t(m,{shape:"circle",onClick:T},{default:e(()=>[u.value==="list"?(i(),p(F,{key:0})):(i(),p(W,{key:1}))]),_:1})]),_:1},8,["content"])]),content:e(c=>[u.value==="window"?(i(),p(Y,{key:0,modelValue:_.value,"onUpdate:modelValue":l[1]||(l[1]=n=>_.value=n),onChange:$},{default:e(()=>[t(X,{infinite:""},{default:e(()=>[t(Q,{class:"window-list"},{default:e(()=>[(i(!0),L(ce,null,ie(c,n=>(i(),L("div",{key:n.id,class:"mb-2 image-content"},[t(J,{value:n.id,class:"checkbox"},{checkbox:e(({checked:M})=>[t(H,{checked:M,color:"blue",checkable:""},{default:e(()=>[t(G),f(" 选择")]),_:2},1032,["checked"])]),_:2},1032,["value"]),t(S,{width:"190",height:"190","show-loader":"",title:n.object_name,description:`大小：${n.size_info}`,src:/image/g.test(n.mime_type)?R(I).attachUrl(n.url,k(n.storage_mode)):"/not-image.png"},{extra:e(()=>[d("div",_e,[t(C,{content:"下载此文件"},{default:e(()=>[d("span",{class:"action",onClick:M=>A(n)},[t(V)],8,me)]),_:2},1024),t(C,null,{content:e(()=>[d("div",null,"存储名称："+y(n.object_name),1),d("div",null,"存储目录："+y(n.storage_path),1),d("div",null,"上传时间："+y(n.created_at),1),d("div",null,"存储模式："+y(k(n.storage_mode)),1)]),default:e(()=>[d("span",pe,[t(K)])]),_:2},1024)])]),_:2},1032,["title","description","src"])]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["modelValue"])):P("",!0)]),url:e(({record:c})=>[/image/g.test(c.mime_type)?(i(),p(S,{key:0,class:"list-image",width:"40px",height:"40px",src:R(I).attachUrl(c.url,k(c.storage_mode))},null,8,["src"])):(i(),p(Z,{key:1,shape:"square",style:{top:"0px"}},{default:e(()=>[f(y(c.suffix),1)]),_:2},1024))]),operationBeforeExtend:e(({record:c})=>[t(ee,{onClick:n=>A(c)},{default:e(()=>[t(V),f(" 下载")]),_:2},1032,["onClick"])]),_:1},8,["options","columns"])])])}}}),be=se(ge,[["__scopeId","data-v-68df89de"]]);export{be as default};
