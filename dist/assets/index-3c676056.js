import{d as c}from"./dataMaintain-8604fbb6.js";import{$ as w}from"./request-372f441e.js";import{r as i,v as u,i as n,W as $,o as m,c as j,p as o,k as t,G as b,j as g,s as r}from"./runtime-core.esm-bundler-0dd628d9.js";const N={class:"ma-content-block lg:flex justify-between pt-4 pl-2 pr-2 pb-2"},P={name:"system:dataMaintain"},A=Object.assign(P,{setup(S){const y=i(),p=i(),l=i([]);i("");const d=i(!1),k=a=>l.value=a,_=async a=>{if(l.value.length===0){w.error("至少要选择一条数据");return}let e;a==="optimize"&&(e=await c.optimize(l.value)),a==="clear"&&(e=await c.fragment(l.value)),e.success&&w.success(e.message)},C=a=>{f.requestParams.table=a,d.value=!0,p.value.requestData()},I=u({api:c.getPageList,searchColNumber:2,pageLayout:"fixed",showIndex:!1,rowSelection:{showCheckedAll:!0,key:"name"},operationColumn:!0,operationWidth:100}),M=u([{title:"表名称",dataIndex:"name",search:!0,width:200},{title:"表引擎",dataIndex:"engine",width:150},{title:"总行数",dataIndex:"rows",width:150},{title:"碎片大小",dataIndex:"data_free",width:150},{title:"数据大小",dataIndex:"data_length",width:150},{title:"索引大小",dataIndex:"index_length",width:150},{title:"字符集",dataIndex:"collation",width:180},{title:"创建时间",dataIndex:"create_time",width:180},{title:"表注释",dataIndex:"comment",width:180}]),f=u({api:c.getDetailed,requestParams:{},autoRequest:!1,showTools:!1});return(a,e)=>{const R=n("icon-tool"),v=n("a-button"),q=n("icon-experiment"),z=n("icon-eye"),B=n("a-link"),x=n("ma-crud"),D=n("a-modal"),h=$("auth");return m(),j("div",N,[o(x,{options:I,columns:M,ref_key:"crudRef",ref:y,onSelectionChange:k},{tableButtons:t(()=>[b((m(),g(v,{onClick:e[0]||(e[0]=s=>_("optimize")),type:"primary",status:"success"},{icon:t(()=>[o(R)]),default:t(()=>[r("优化表 ")]),_:1})),[[h,["system:dataMaintain:optimize"]]]),b((m(),g(v,{onClick:e[1]||(e[1]=s=>_("clear")),type:"primary",status:"success"},{icon:t(()=>[o(q)]),default:t(()=>[r("清理碎片 ")]),_:1})),[[h,["system:dataMaintain:fragment"]]])]),operationCell:t(({record:s})=>[o(B,{onClick:L=>C(s.name)},{default:t(()=>[o(z),r(" 查看 ")]),_:2},1032,["onClick"])]),_:1},8,["options","columns"]),o(D,{visible:d.value,"onUpdate:visible":e[2]||(e[2]=s=>d.value=s),width:"900px",footer:!1},{title:t(()=>[r("表结构数据")]),default:t(()=>[o(x,{ref_key:"tableRef",ref:p,options:f,columns:[{title:"字段名称",dataIndex:"column_name"},{title:"字段类型",dataIndex:"column_type"},{title:"字段注释",dataIndex:"column_comment"}]},null,8,["options"])]),_:1},8,["visible"])])}}});export{A as default};
