import{c as a,_ as T}from"./logList-803263b5.js";import{$ as u}from"./request-7ebe3d6d.js";import{r as p,v as m,i as s,W as q,o as h,c as B,p as e,k as c,G as L,j as V,s as _}from"./runtime-core.esm-bundler-0dd628d9.js";import"./index-8e0d8596.js";const $={class:"ma-content-block lg:flex justify-between pt-4 pl-2 pr-2 pb-2"},j={name:"system:crontab"},N=Object.assign(j,{setup(O){const f=p(),l=p(),g=[{label:"命令任务",value:1},{label:"类任务",value:2},{label:"URL任务",value:3},{label:"PHP脚本任务",value:4}],y=async(t,o)=>{const r=await a.changeStatus({id:o,status:t});r.success&&u.success(r.message)},v=async t=>{const o=await a.run({id:t.id});o.success&&u.success(o.message)},x=t=>{l.value.open(t.id)},w=m({api:a.getPageList,showIndex:!1,pageLayout:"fixed",rowSelection:{showCheckedAll:!0},operationColumn:!0,operationWidth:280,add:{show:!0,api:a.save,auth:["setting:crontab:save"]},edit:{show:!0,api:a.update,auth:["setting:crontab:update"]},delete:{show:!0,api:a.deletes,auth:["setting:crontab:delete"]}}),k=m([{title:"ID",dataIndex:"id",addDisplay:!1,editDisplay:!1,width:50,hide:!0},{title:"任务名称",dataIndex:"name",search:!0,commonRules:[{required:!0,message:"任务名称必填"}],width:200},{title:"任务类型",dataIndex:"type",search:!0,commonRules:[{required:!0,message:"任务类型必选"}],dict:{data:g,translation:!0},formType:"select",width:150},{title:"定时规则",dataIndex:"rule",commonRules:[{required:!0,message:"定时规则必填"}],extra:"例如：30 */5 * * * *，代表每隔5分钟的第30秒执行任务",width:150},{title:"调用目标",dataIndex:"target",formType:"textarea",commonRules:[{required:!0,message:"调用目标必填"}],width:260},{title:"任务参数",dataIndex:"parameter",formType:"textarea",width:200,hide:!0},{title:"单次执行",dataIndex:"singleton",formType:"radio",addDefaultValue:2,dict:{data:[{label:"是",value:1},{label:"否",value:2}]},hide:!0},{title:"状态",dataIndex:"status",search:!0,formType:"radio",dict:{name:"data_status",props:{label:"title",value:"key"}},addDefaultValue:1,width:120},{title:"备注",dataIndex:"remark",hide:!0,formType:"textarea"},{title:"创建时间",dataIndex:"created_at",addDisplay:!1,editDisplay:!1,search:!0,formType:"range",width:180}]);return(t,o)=>{const r=s("a-switch"),b=s("icon-caret-right"),d=s("a-link"),I=s("a-popconfirm"),D=s("icon-history"),R=s("ma-crud"),C=q("auth");return h(),B("div",$,[e(R,{options:w,columns:k,ref_key:"crudRef",ref:f},{status:c(({record:n})=>[e(r,{"checked-value":1,"unchecked-value":"2",onChange:i=>y(i,n.id),"default-checked":n.status==1},null,8,["onChange","default-checked"])]),operationBeforeExtend:c(({record:n})=>[e(I,{content:"确定立刻执行一次?",position:"bottom",onOk:i=>v(n)},{default:c(()=>[L((h(),V(d,null,{default:c(()=>[e(b),_(" 执行一次")]),_:1})),[[C,["setting:crontab:run"]]])]),_:2},1032,["onOk"]),e(d,{onClick:i=>x(n)},{default:c(()=>[e(D),_(" 日志 ")]),_:2},1032,["onClick"])]),_:1},8,["options","columns"]),e(T,{ref_key:"logsRef",ref:l},null,512)])}}});export{N as default};
