import{g as _}from"./generate-813130fa.js";import{a as A}from"./index-895e8cc8.js";import{$ as d,a0 as G}from"./request-7ebe3d6d.js";import P from"./loadTable-874f1039.js";import U from"./preview-0f0c4bf3.js";import V from"./editInfo-4d92a00b.js";import{r as p,v as x,i as n,W as z,o as c,c as M,p as e,k as t,G as i,j as r,s as l}from"./runtime-core.esm-bundler-0dd628d9.js";import"./dataMaintain-1ecf9a8d.js";import"./datasource-0712472c.js";import"./common-a36cd801.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./common-5d647e0d.js";import"./menu-5badf908.js";import"./role-e30c5a62.js";import"./dict-895e2bfe.js";import"./settingComponent-be1565fa.js";const q={class:"ma-content-block lg:flex justify-between pt-4 pl-2 pr-2 pb-2"},F={name:"setting:code"},de=Object.assign(F,{setup(H){const g=p(),h=p(),v=p(),k=p(),f=p([]);A();const R=[{label:"单表CRUD",value:"single"},{label:"树表CRUD",value:"tree"}],I=s=>{s&&g.value.refresh()},B=async s=>{const o=await _.sync(s);o.success&&d.success(o.message)},y=async s=>{d.info("代码生成下载中，请稍后");const o=await _.generateCode({ids:s.toString().split(",")});o.message&&!o.success?d.error(o.message):(G.download(o,"generated.zip"),d.success("代码生成成功，开始下载"))},S=()=>{if(f.value.length===0){d.error("至少要选择一条数据");return}y(f.value.join(","))},T=s=>f.value=s,$=x({api:_.getPageList,showIndex:!1,searchColNumber:3,searchLabelWidth:"75px",pageLayout:"fixed",rowSelection:{showCheckedAll:!0},operationColumn:!0,operationWidth:400,operationColumnWidth:400,delete:{show:!0,api:_.deletes,auth:["setting:code:delete"]}}),j=x([{title:"表名称",dataIndex:"table_name",search:!0,width:200},{title:"表描述",dataIndex:"table_comment",width:350},{title:"生成类型",dataIndex:"type",formType:"select",width:120,dict:{data:R,translation:!0}},{title:"创建时间",dataIndex:"created_at",width:180}]);return(s,o)=>{const C=n("icon-code"),b=n("a-button"),D=n("icon-export"),W=n("icon-eye"),u=n("a-link"),E=n("icon-sync"),L=n("a-popconfirm"),N=n("icon-edit"),O=n("ma-crud"),a=z("auth");return c(),M("div",q,[e(O,{options:$,columns:j,ref_key:"crudRef",ref:g,onSelectionChange:T},{tableAfterButtons:t(()=>[i((c(),r(b,{type:"outline",onClick:S},{icon:t(()=>[e(C)]),default:t(()=>[l(" 生成代码 ")]),_:1})),[[a,["setting:code:generate"]]]),i((c(),r(b,{onClick:o[0]||(o[0]=()=>k.value.open()),type:"outline",status:"success"},{icon:t(()=>[e(D)]),default:t(()=>[l(" 装载数据表 ")]),_:1})),[[a,["setting:code:loadTable"]]])]),operationBeforeExtend:t(({record:m})=>[i((c(),r(u,{onClick:w=>v.value.open(m.id)},{default:t(()=>[e(W),l(" 预览 ")]),_:2},1032,["onClick"])),[[a,["setting:code:preview"]]]),e(L,{content:"同步会重置字段配置生成信息，确定同步吗?",position:"bottom",onOk:w=>B(m.id)},{default:t(()=>[i((c(),r(u,null,{default:t(()=>[e(E),l(" 同步 ")]),_:1})),[[a,["setting:code:sync"]]])]),_:2},1032,["onOk"]),i((c(),r(u,{onClick:()=>h.value.open(m.id)},{default:t(()=>[e(N),l(" 编辑 ")]),_:2},1032,["onClick"])),[[a,["setting:code:update"]]]),i((c(),r(u,{onClick:w=>y(m.id)},{default:t(()=>[e(C),l(" 生成代码 ")]),_:2},1032,["onClick"])),[[a,["setting:code:generate"]]])]),_:1},8,["options","columns"]),e(P,{ref_key:"loadTableRef",ref:k,onSuccess:I},null,512),e(U,{ref_key:"previewRef",ref:v},null,512),e(V,{ref_key:"editRef",ref:h},null,512)])}}});export{de as default};
