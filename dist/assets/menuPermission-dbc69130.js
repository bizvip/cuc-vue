import{M as A}from"./index-492d5734.js";import{r as h}from"./role-e97fee2c.js";import{m as E}from"./menu-1a9c7001.js";import{_ as K}from"./_plugin-vue_export-helper-c27b6911.js";import{$ as S}from"./request-372f441e.js";import{r as c,i as u,o as j,j as z,k as o,s as f,p as s,a as y}from"./runtime-core.esm-bundler-0dd628d9.js";const D={class:"w-full"},I={class:"tree-container p-2"},O={__name:"menuPermission",emits:["success"],setup($,{expose:x,emit:C}){const r=c(!1),g=c(!0),v=c([]),p=c([]),_=c(!1),i=c(),d=c({name:void 0,code:void 0}),N=e=>{d.value={id:e.id,name:e.name,code:e.code},b(!1),V(!1),k(!1),T(e.id),r.value=!0},b=e=>{i.value.maTree.expandAll(e)},V=e=>{i.value.maTree.checkAll(e)},k=e=>{_.value=e},M=e=>{const a=i.value.maTree,t=a.getExpandedNodes().map(n=>n.id);a.expandNode(e,!t.includes(e[0]))},T=async e=>{const a=await E.tree({scope:!0});v.value=a.data;const t=await h.getMenuByRole(e);p.value=t.data[0].menus.map(n=>n.id),p.value.length>0&&k(!0),g.value=!1},U=async e=>{const t=i.value.maTree.getCheckedNodes().map(m=>m.id),n=await h.updateMenuPermission(d.value.id,{menu_ids:t});n.success&&S.success(n.message),C("success"),e(!0)},B=()=>r.value=!1;return x({open:N}),(e,a)=>{const t=u("a-input"),n=u("a-form-item"),m=u("a-checkbox"),P=u("a-space"),w=u("a-spin"),L=u("a-form"),R=u("a-modal");return j(),z(R,{visible:r.value,"onUpdate:visible":a[5]||(a[5]=l=>r.value=l),onCancel:B,onBeforeOk:U},{title:o(()=>[f("菜单权限")]),default:o(()=>[s(L,{model:d.value},{default:o(()=>[s(n,{label:"角色名称",field:"name"},{default:o(()=>[s(t,{disabled:"",modelValue:d.value.name,"onUpdate:modelValue":a[0]||(a[0]=l=>d.value.name=l)},null,8,["modelValue"])]),_:1}),s(n,{label:"角色标识",field:"code"},{default:o(()=>[s(t,{disabled:"",modelValue:d.value.code,"onUpdate:modelValue":a[1]||(a[1]=l=>d.value.code=l)},null,8,["modelValue"])]),_:1}),s(n,{label:"菜单列表",field:"menu_ids"},{default:o(()=>[s(w,{loading:g.value,tip:"菜单加载中...",class:"w-full"},{default:o(()=>[y("div",D,[s(P,{class:"mt-1.5",size:"large"},{default:o(()=>[s(m,{onChange:b},{default:o(()=>[f("展开/折叠")]),_:1}),s(m,{onChange:V},{default:o(()=>[f("全选/全不选")]),_:1}),s(m,{modelValue:_.value,"onUpdate:modelValue":a[2]||(a[2]=l=>_.value=l),onChange:k},{default:o(()=>[f("关闭父子级联动")]),_:1},8,["modelValue"])]),_:1}),y("div",I,[s(A,{ref_key:"tree",ref:i,modelValue:v.value,"onUpdate:modelValue":a[3]||(a[3]=l=>v.value=l),checkable:"",fieldNames:{title:"label",key:"id"},searchPlaceholder:"过滤菜单","checked-keys":p.value,"onUpdate:checkedKeys":a[4]||(a[4]=l=>p.value=l),"check-strictly":_.value,"virtual-list-props":{height:300},onClick:M},null,8,["modelValue","checked-keys","check-strictly"])])])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])}}},W=K(O,[["__scopeId","data-v-ca73b0c4"]]);export{W as default};
